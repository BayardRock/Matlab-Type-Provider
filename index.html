<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>F# Matlab Type Provider by BayardRock</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1>F# Matlab Type Provider</h1>
        <p>A (not yet complete) Type Provider for Matlab in the spirit of the R Type Provider</p>

        <p class="view"><a href="https://github.com/BayardRock/Matlab-Type-Provider">View the Project on GitHub <small>BayardRock/Matlab-Type-Provider</small></a></p>


        <ul>
          <li><a href="https://github.com/BayardRock/Matlab-Type-Provider/zipball/master">Download <strong>ZIP File</strong></a></li>
          <li><a href="https://github.com/BayardRock/Matlab-Type-Provider/tarball/master">Download <strong>TAR Ball</strong></a></li>
          <li><a href="https://github.com/BayardRock/Matlab-Type-Provider">View On <strong>GitHub</strong></a></li>
        </ul>
      </header>
      <section>
        <h3>
<a name="what-to-expect" class="anchor" href="#what-to-expect"><span class="octicon octicon-link"></span></a>What to expect</h3>

<p>The goal of this project is to provide a smooth and efficient framework for F#-Matlab interactions.  The goals for 1.0 include support for most Matlab functions and types in as well typed a manner as possible.</p>

<p>A simple version of our goal is now working fairly well.  Give it a little play and let me know if you find any problems.</p>

<h3>
<a name="current-requirements" class="anchor" href="#current-requirements"><span class="octicon octicon-link"></span></a>Current Requirements</h3>

<ul>
<li>Matlab 2013a (or earlier with <a href="http://www.mathworks.com/matlabcentral/fileexchange/31862-strjoin">strjoin.m</a>, tested up to 2012a)</li>
<li>Visual Studio 2012 (May work with other Windows F# IDEs as well, but not tested)</li>
</ul><h3>
<a name="current-capabilities" class="anchor" href="#current-capabilities"><span class="octicon octicon-link"></span></a>Current Capabilities</h3>

<ul>
<li>Access non-complex Values, Matrices and Vectors in a strongly typed fashion. </li>
<li>The ability to call Matlab Toolbox functions with appropriate F# values and handles to Matlab variables.</li>
</ul><h3>
<a name="getting-started" class="anchor" href="#getting-started"><span class="octicon octicon-link"></span></a>Getting Started</h3>

<p>Add the following parameters to your Matlab 2013a shortcut:</p>

<p><code>matlab.exe -automation -desktop</code></p>

<p>This will allow you to keep a Matlab session open while you connect and disconnect with Visual Studio. If you don't do this then the Matlab Provider will launch a session when it starts which will close when the Type Provider is unloaded. </p>

<p>Then you must load the type provider.  This is done either by an assembly reference, if you're using it in your project, or by specifying it like so (and the required namespaces) in your F# .fsx script:</p>

<div class="highlight highlight-fsharp"><pre><span class="o">#</span><span class="nc">R</span> <span class="s2">"MatlabTypeProvider.dll"</span>
<span class="k">open</span> <span class="nc">FSMatlab</span>
<span class="k">open</span> <span class="nn">FSMatlab</span><span class="p">.</span><span class="nc">InterfaceTypes</span>
</pre></div>

<p>With the Matlab Type Provider you work primarily with handles to functions and variables. Standard .NET values are supported interchangeably as well in order to make marshaling data across a simple matter.  Working this way prevents a lot of extra pushing data back-and-forth from Matlab when doing complex combinations of functions.  You must also specify exactly how many output parameters you would like.  This is because Matlab functions may opt not to calculate unused results.</p>

<div class="highlight highlight-fsharp"><pre><span class="k">open</span> <span class="nn">Toolboxes</span><span class="p">.</span><span class="n">matlab</span><span class="o">.</span><span class="n">elmat</span> <span class="c1">// Open Matlab ToolBox as Namespace</span>
<span class="k">let</span> <span class="n">m</span><span class="o">,</span><span class="n">n</span> <span class="o">=</span> <span class="nn">M</span><span class="p">.</span><span class="n">size</span><span class="o">([|</span><span class="mi">1</span><span class="o">.</span><span class="mi">0</span><span class="o">;</span><span class="mi">2</span><span class="o">.</span><span class="mi">0</span><span class="o">;</span><span class="mi">3</span><span class="o">.</span><span class="mi">0</span><span class="o">;</span><span class="mi">4</span><span class="o">.</span><span class="mi">0</span><span class="o">;</span><span class="mi">5</span><span class="o">.</span><span class="mi">0</span><span class="o">|])</span> <span class="o">|&gt;</span> <span class="nc">EGT2</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">,</span><span class="kt">double</span><span class="o">&gt;</span>
</pre></div>

<p>Here EGT2 stands for Execute-Get-Typed with two outputs.  Because you are not being returned a variable  handle this will automatically delete the temporary result.  We also provide the E function which just executes and returns a handle:</p>

<div class="highlight highlight-fsharp"><pre><span class="k">open</span> <span class="nn">Toolboxes</span><span class="p">.</span><span class="n">matlab</span><span class="o">.</span><span class="n">elfun</span>
<span class="k">use</span> <span class="n">x</span> <span class="o">=</span> <span class="nn">M</span><span class="p">.</span><span class="n">nthroot</span><span class="o">(</span><span class="mi">9</span><span class="o">.</span><span class="mi">0</span><span class="o">,</span> <span class="mi">2</span><span class="o">.</span><span class="mi">0</span><span class="o">)</span> <span class="o">|&gt;</span> <span class="nc">E1</span>
</pre></div>

<p>Here x is a handle to an active variable in your Matlab instance.  Note that it implements IDisposable and so when bound with the <strong>use</strong> keyword will automatically be deleted from Matlab when it leaves scope.  You can use it as you see fit and delete it when you're done.  </p>

<div class="highlight highlight-fsharp"><pre><span class="k">let</span> <span class="n">x_val_obj</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="nc">GetUntyped</span><span class="bp">()</span> <span class="c1">// type is obj</span>
<span class="k">let</span> <span class="n">x_val_typed</span> <span class="o">:</span> <span class="kt">double</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="nc">Get</span><span class="bp">()</span> <span class="c1">// type is double</span>
</pre></div>

<h3>
<a name="known-problems--future-work" class="anchor" href="#known-problems--future-work"><span class="octicon octicon-link"></span></a>Known Problems / Future Work</h3>

<ul>
<li>The current communication interface is COM, and I expect this puts a limit on the size of things.  I hope to be moving to the dll interface once I get things going a bit more.  In the long run I'd very much like to be able to support MacOS and Linux. </li>
<li>The type provider does not currently take any static parameters.  I'd like it to support at least the ability to select the way to contact Matlab and also to execute a specified script to bind variables.</li>
<li>It would be ideal to be able to compose up computations with functions and operators in F# and then have the entire call be executed in Matlab.  This may take some doing, but I believe it's completely possible. </li>
<li>Octave is not supported. If anyone would like to provide me with a wrapper assembly I would happily extend the type provider to support it. </li>
</ul><h3>
<a name="planned-limitations" class="anchor" href="#planned-limitations"><span class="octicon octicon-link"></span></a>Planned Limitations</h3>

<ul>
<li>The parameters to and the result of calls to Matlab functions will remain untyped for the foreseeable future.  As it currently stands, there seems be no way to provide types for Matlab functions without manual labeling as with TypeScript.</li>
</ul>
      </section>
      <footer>
        <p>This project is maintained by <a href="https://github.com/BayardRock">BayardRock</a></p>
        <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></small></p>
      </footer>
    </div>
    <script src="javascripts/scale.fix.js"></script>
    
  </body>
</html>